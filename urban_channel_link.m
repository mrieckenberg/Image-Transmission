% https://www.mathworks.com/help/comm/ug/urban-channel-link-analysis-and-visualization-using-ray-tracing.html
clc;
clear;
close all;

max_range = 3000;

viewer = siteviewer(Buildings="carleton.osm",Basemap="topographic");



% Rogers
rogers_tx1 = txsite(Name="Rogers Tx 1", ...
    Latitude=45.38647, ...
    Longitude=-75.6976, ...
    AntennaHeight=39, ...
    TransmitterPower=28.2, ...
    Antenna='isotropic',...
    TransmitterFrequency=3.5e9);

rogers_tx2 = txsite(Name="Rogers Tx 2", ...
    Latitude=45.38269, ...
    Longitude=-75.6993, ...
    AntennaHeight=85, ...
    TransmitterPower=28.2, ...
    Antenna='isotropic',...
    TransmitterFrequency=3.5e9);

rogers_tx3 = txsite(Name="Rogers Tx 3", ...
    Latitude=45.37504, ...
    Longitude=-75.6927, ...
    AntennaHeight=30, ...
    TransmitterPower=28.2, ...
    Antenna='isotropic',...
    TransmitterFrequency=3.5e9);

rogers_tx4 = txsite(Name="Rogers Tx 4", ...
    Latitude=45.39091, ...
    Longitude=-75.7236, ...
    AntennaHeight=31, ...
    TransmitterPower=28.2, ...
    Antenna='isotropic',...
    TransmitterFrequency=3.5e9);

show(rogers_tx1);
show(rogers_tx2);
show(rogers_tx3);
show(rogers_tx4);


% Testing
rtpm = propagationModel("raytracing", ...
    Method="sbr", ...
    MaxNumReflections=0, ...
    BuildingsMaterial="concrete", ...
    TerrainMaterial="concrete");
coverage(rogers_tx1,rtpm, ...
    SignalStrengths=-120:-5, ...
    MaxRange=max_range, ...
    Resolution=3, ...
    Transparency=0.6);
coverage(rogers_tx2,rtpm, ...
    SignalStrengths=-120:-5, ...
    MaxRange=max_range, ...
    Resolution=3, ...
    Transparency=0.6);
coverage(rogers_tx3,rtpm, ...
    SignalStrengths=-120:-5, ...
    MaxRange=max_range, ...
    Resolution=3, ...
    Transparency=0.6);
coverage(rogers_tx4,rtpm, ...
    SignalStrengths=-120:-5, ...
    MaxRange=max_range, ...
    Resolution=3, ...
    Transparency=0.6);

% rx1 = rxsite(Name="UE1", ...
%     Latitude=45.386647, ...
%     Longitude=-75.697629, ...
%     AntennaHeight=1);
% 
% los(rogers_tx1,rx1);